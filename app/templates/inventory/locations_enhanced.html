{% extends "base.html" %}

{% block title %}Storage Location Management{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/locations-enhanced.css') }}" rel="stylesheet">
<!-- Chart.js for capacity visualization -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
{% endblock %}

{% block content %}
<div class="location-management">
    <div class="location-container">
        <!-- Enhanced Header Section -->
        <div class="location-header fade-in-up">
            <div class="location-title">
                <div>
                    <div class="title-icon">
                        <i class="bi bi-geo-alt"></i>
                    </div>
                    <h1>Storage Location Management</h1>
                </div>
                <div class="location-breadcrumb">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">
                                <a href="{{ url_for('inventory.index') }}">
                                    <i class="bi bi-house me-1"></i>Inventory
                                </a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">
                                Storage Locations
                            </li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Enhanced Statistics Overview -->
        <div class="location-stats-grid fade-in-up">
            <div class="stat-card total-locations">
                <div class="stat-card-header">
                    <div>
                        <div class="stat-number">{{ locations|length }}</div>
                        <div class="stat-label">Total Locations</div>
                        <div class="stat-trend positive">
                            <i class="bi bi-arrow-up"></i>
                            <span>+2 this month</span>
                        </div>
                    </div>
                    <div class="stat-icon">
                        <i class="bi bi-geo-alt"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card total-items">
                <div class="stat-card-header">
                    <div>
                        <div class="stat-number">{{ total_items }}</div>
                        <div class="stat-label">Items Stored</div>
                        <div class="stat-trend positive">
                            <i class="bi bi-arrow-up"></i>
                            <span>+15 this week</span>
                        </div>
                    </div>
                    <div class="stat-icon">
                        <i class="bi bi-box-seam"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card avg-utilization">
                <div class="stat-card-header">
                    <div>
                        <div class="stat-number">{{ avg_utilization|round(1) }}%</div>
                        <div class="stat-label">Average Utilization</div>
                        <div class="stat-trend neutral">
                            <i class="bi bi-dash"></i>
                            <span>No change</span>
                        </div>
                    </div>
                    <div class="stat-icon">
                        <i class="bi bi-pie-chart"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card nearly-full">
                <div class="stat-card-header">
                    <div>
                        <div class="stat-number">{{ nearly_full_count }}</div>
                        <div class="stat-label">Nearly Full</div>
                        <div class="stat-trend negative">
                            <i class="bi bi-arrow-up"></i>
                            <span>+1 this week</span>
                        </div>
                    </div>
                    <div class="stat-icon">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Toolbar Section -->
        <div class="location-toolbar slide-in-left">
            <div class="toolbar-section">
                <div class="toolbar-left">
                    <div class="location-search-container">
                        <i class="bi bi-search search-icon"></i>
                        <input type="text" 
                               id="locationSearch" 
                               class="location-search" 
                               placeholder="Search locations by name, type, or capacity...">
                    </div>
                    
                    <div class="filter-group">
                        <select id="locationTypeFilter" class="filter-select">
                            <option value="">All Types</option>
                            <option value="room">Room</option>
                            <option value="cabinet">Cabinet</option>
                            <option value="shelf">Shelf</option>
                            <option value="freezer">Freezer</option>
                            <option value="fridge">Fridge</option>
                        </select>
                        
                        <select id="capacityFilter" class="filter-select">
                            <option value="">All Capacities</option>
                            <option value="available">Available Space</option>
                            <option value="warning">Nearly Full (>80%)</option>
                            <option value="full">At Capacity</option>
                        </select>
                    </div>
                </div>
                
                <div class="toolbar-right">
                    <div class="view-toggle">
                        <button class="view-toggle-btn active" data-view="split">
                            <i class="bi bi-layout-split me-1"></i>Split View
                        </button>
                        <button class="view-toggle-btn" data-view="tree">
                            <i class="bi bi-diagram-3 me-1"></i>Tree View
                        </button>
                        <button class="view-toggle-btn" data-view="list">
                            <i class="bi bi-list-ul me-1"></i>List View
                        </button>
                    </div>
                    
                    <div class="toolbar-actions">
                        <button class="action-btn secondary" id="expandAllBtn">
                            <i class="bi bi-arrows-expand"></i>
                            <span>Expand All</span>
                        </button>
                        <button class="action-btn secondary" id="collapseAllBtn">
                            <i class="bi bi-arrows-collapse"></i>
                            <span>Collapse All</span>
                        </button>
                        <button class="action-btn primary" id="addLocationBtn">
                            <i class="bi bi-plus-lg"></i>
                            <span>Add Location</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Capacity Legend -->
        <div class="capacity-legend slide-in-right">
            <div class="legend-title">Capacity Status Legend</div>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color capacity-normal"></div>
                    <span>Normal (&lt;60%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color capacity-warning"></div>
                    <span>Warning (60-80%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color capacity-danger"></div>
                    <span>Critical (80-100%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color capacity-full"></div>
                    <span>At Capacity (100%)</span>
                </div>
            </div>
        </div>

        <!-- Enhanced Main Content - Split View Layout -->
        <div class="location-main-content" id="mainContent">
            <!-- Left Panel - Tree View -->
            <div class="location-tree-panel slide-in-left">
                <div class="tree-panel-header">
                    <h3 class="tree-panel-title">
                        <i class="bi bi-diagram-3 me-2"></i>
                        Location Hierarchy
                    </h3>
                </div>
                <div class="tree-panel-body">
                    <div class="location-tree" id="locationTree">
                        {% for location in root_locations %}
                            {% include 'inventory/partials/location_node_enhanced.html' %}
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Right Panel - Details View -->
            <div class="location-details-panel slide-in-right">
                <div class="details-panel-header">
                    <div>
                        <h3 class="details-panel-title" id="detailsTitle">
                            <i class="bi bi-info-circle me-2"></i>
                            Select a Location
                        </h3>
                        <p class="details-panel-subtitle" id="detailsSubtitle">
                            Choose a location from the tree to view detailed information
                        </p>
                    </div>
                    <div class="details-panel-actions" id="detailsActions" style="display: none;">
                        <button class="action-btn secondary" id="editLocationBtn">
                            <i class="bi bi-pencil"></i>
                            <span>Edit</span>
                        </button>
                        <button class="action-btn secondary" id="addChildBtn">
                            <i class="bi bi-plus"></i>
                            <span>Add Child</span>
                        </button>
                        <button class="action-btn secondary" id="deleteLocationBtn">
                            <i class="bi bi-trash"></i>
                            <span>Delete</span>
                        </button>
                    </div>
                </div>
                <div class="details-panel-body">
                    <div class="details-empty-state" id="emptyState">
                        <div class="empty-state-icon">
                            <i class="bi bi-geo-alt"></i>
                        </div>
                        <div class="empty-state-title">No Location Selected</div>
                        <div class="empty-state-description">
                            Click on any location in the tree view to see its detailed information, capacity usage, and stored items.
                        </div>
                    </div>
                    <div class="location-details-content" id="detailsContent" style="display: none;">
                        <!-- Content will be loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Location Details Modal -->
<div class="modal fade location-modal" id="locationDetailsModal" tabindex="-1" aria-labelledby="locationDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="locationDetailsModalLabel">Location Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="locationDetailsContent">
                    <!-- Content loaded via AJAX -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="editLocationModalBtn">Edit Location</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/locations-enhanced.js') }}"></script>
{% endblock %}