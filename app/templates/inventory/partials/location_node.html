{% set capacity_percent = (location.current_usage / location.max_capacity * 100) if location.max_capacity else 0 %}
{% set capacity_class = 'capacity-full' if capacity_percent >= 100 else 'capacity-danger' if capacity_percent >= 80 else 'capacity-warning' if capacity_percent >= 60 else 'capacity-normal' %}

<div class="location-node" 
     data-location-id="{{ location.id }}" 
     data-location-type="{{ location.location_type or '' }}"
     data-capacity-usage="{{ capacity_percent }}"
     data-location-name="{{ location.name }}"
     data-full-path="{{ location.full_path }}">
    
    <div class="location-info">
        <div class="location-toggle">
            {% if location.children %}
                <i class="bi bi-chevron-right"></i>
            {% else %}
                <i class="bi bi-circle-fill" style="font-size: 6px; opacity: 0.3;"></i>
            {% endif %}
        </div>
        
        <div class="location-details">
            <div class="location-name">{{ location.name }}</div>
            
            <div class="location-meta">
                {% if location.location_type %}
                <span class="location-type-badge">{{ location.location_type }}</span>
                {% endif %}
                
                {% if location.temperature %}
                <span class="location-temp-badge">{{ location.temperature }}</span>
                {% endif %}
            </div>
            
            {% if location.max_capacity %}
            <div class="location-capacity">
                <div class="capacity-bar-container">
                    <span class="capacity-text">{{ location.current_usage }}/{{ location.max_capacity }}</span>
                    <div class="capacity-bar">
                        <div class="capacity-fill {{ capacity_class }}" 
                             style="width: {{ capacity_percent|min(100) }}%"></div>
                    </div>
                    <span class="capacity-percentage">{{ capacity_percent|round(1) }}%</span>
                </div>
            </div>
            {% else %}
            <div class="location-capacity">
                <div class="capacity-bar-container">
                    <span class="capacity-text">{{ location.current_usage }} items</span>
                    <span class="capacity-percentage">Unlimited</span>
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="location-actions">
            <button class="btn-location btn-view" 
                    data-location-id="{{ location.id }}" 
                    title="View Details">
                <i class="bi bi-eye"></i>
            </button>
            
            <button class="btn-location btn-add" 
                    data-location-id="{{ location.id }}" 
                    title="Add Child Location">
                <i class="bi bi-plus"></i>
            </button>
            
            <button class="btn-location btn-edit" 
                    data-location-id="{{ location.id }}" 
                    title="Edit Location">
                <i class="bi bi-pencil"></i>
            </button>
            
            <button class="btn-location btn-delete" 
                    data-location-id="{{ location.id }}" 
                    title="Delete Location">
                <i class="bi bi-trash"></i>
            </button>
        </div>
    </div>
    
    {% if location.children %}
    <div class="location-children">
        {% for child in location.children %}
            <div class="location-indent">
                {% with location=child %}
                    {% include 'inventory/partials/location_node.html' %}
                {% endwith %}
            </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
